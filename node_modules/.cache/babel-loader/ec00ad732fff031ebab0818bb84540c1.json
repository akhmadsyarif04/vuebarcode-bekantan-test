{"remainingRequest":"/srv/http/bekantan-vue-testing/node_modules/babel-loader/lib/index.js!/srv/http/bekantan-vue-testing/node_modules/eslint-loader/index.js??ref--13-0!/srv/http/bekantan-vue-testing/instascan/src/scanner.js","dependencies":[{"path":"/srv/http/bekantan-vue-testing/instascan/src/scanner.js","mtime":1493558896000},{"path":"/srv/http/bekantan-vue-testing/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/srv/http/bekantan-vue-testing/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/srv/http/bekantan-vue-testing/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"/srv/http/bekantan-vue-testing/node_modules/@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _possibleConstructorReturn from \"/srv/http/bekantan-vue-testing/node_modules/@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/srv/http/bekantan-vue-testing/node_modules/@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"/srv/http/bekantan-vue-testing/node_modules/@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/srv/http/bekantan-vue-testing/node_modules/@babel/runtime-corejs2/helpers/esm/inherits\";\nimport \"core-js/modules/es6.math.trunc\";\nimport \"core-js/modules/es6.typed.uint8-array\";\nimport _classCallCheck from \"/srv/http/bekantan-vue-testing/node_modules/@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"/srv/http/bekantan-vue-testing/node_modules/@babel/runtime-corejs2/helpers/esm/createClass\";\n\nvar EventEmitter = require('events');\n\nvar ZXing = require('./zxing')();\n\nvar Visibility = require('visibilityjs');\n\nvar StateMachine = require('fsm-as-promised');\n\nvar ScanProvider =\n/*#__PURE__*/\nfunction () {\n  function ScanProvider(emitter, analyzer, captureImage, scanPeriod, refractoryPeriod) {\n    _classCallCheck(this, ScanProvider);\n\n    this.scanPeriod = scanPeriod;\n    this.captureImage = captureImage;\n    this.refractoryPeriod = refractoryPeriod;\n    this._emitter = emitter;\n    this._frameCount = 0;\n    this._analyzer = analyzer;\n    this._lastResult = null;\n    this._active = false;\n  }\n\n  _createClass(ScanProvider, [{\n    key: \"start\",\n    value: function start() {\n      var _this = this;\n\n      this._active = true;\n      requestAnimationFrame(function () {\n        return _this._scan();\n      });\n    }\n  }, {\n    key: \"stop\",\n    value: function stop() {\n      this._active = false;\n    }\n  }, {\n    key: \"scan\",\n    value: function scan() {\n      return this._analyze(false);\n    }\n  }, {\n    key: \"_analyze\",\n    value: function _analyze(skipDups) {\n      var _this2 = this;\n\n      var analysis = this._analyzer.analyze();\n\n      if (!analysis) {\n        return null;\n      }\n\n      var result = analysis.result,\n          canvas = analysis.canvas;\n\n      if (!result) {\n        return null;\n      }\n\n      if (skipDups && result === this._lastResult) {\n        return null;\n      }\n\n      clearTimeout(this.refractoryTimeout);\n      this.refractoryTimeout = setTimeout(function () {\n        _this2._lastResult = null;\n      }, this.refractoryPeriod);\n      var image = this.captureImage ? canvas.toDataURL('image/webp', 0.8) : null;\n      this._lastResult = result;\n      var payload = {\n        content: result\n      };\n\n      if (image) {\n        payload.image = image;\n      }\n\n      return payload;\n    }\n  }, {\n    key: \"_scan\",\n    value: function _scan() {\n      var _this3 = this;\n\n      if (!this._active) {\n        return;\n      }\n\n      requestAnimationFrame(function () {\n        return _this3._scan();\n      });\n\n      if (++this._frameCount !== this.scanPeriod) {\n        return;\n      } else {\n        this._frameCount = 0;\n      }\n\n      var result = this._analyze(true);\n\n      if (result) {\n        setTimeout(function () {\n          _this3._emitter.emit('scan', result.content, result.image || null);\n        }, 0);\n      }\n    }\n  }]);\n\n  return ScanProvider;\n}();\n\nvar Analyzer =\n/*#__PURE__*/\nfunction () {\n  function Analyzer(video) {\n    _classCallCheck(this, Analyzer);\n\n    this.video = video;\n    this.imageBuffer = null;\n    this.sensorLeft = null;\n    this.sensorTop = null;\n    this.sensorWidth = null;\n    this.sensorHeight = null;\n    this.canvas = document.createElement('canvas');\n    this.canvas.style.display = 'none';\n    this.canvasContext = null;\n    this.decodeCallback = ZXing.Runtime.addFunction(function (ptr, len, resultIndex, resultCount) {\n      var result = new Uint8Array(ZXing.HEAPU8.buffer, ptr, len);\n      var str = String.fromCharCode.apply(null, result);\n\n      if (resultIndex === 0) {\n        window.zxDecodeResult = '';\n      }\n\n      window.zxDecodeResult += str;\n    });\n  }\n\n  _createClass(Analyzer, [{\n    key: \"analyze\",\n    value: function analyze() {\n      if (!this.video.videoWidth) {\n        return null;\n      }\n\n      if (!this.imageBuffer) {\n        var videoWidth = this.video.videoWidth;\n        var videoHeight = this.video.videoHeight;\n        this.sensorWidth = videoWidth;\n        this.sensorHeight = videoHeight;\n        this.sensorLeft = Math.floor(videoWidth / 2 - this.sensorWidth / 2);\n        this.sensorTop = Math.floor(videoHeight / 2 - this.sensorHeight / 2);\n        this.canvas.width = this.sensorWidth;\n        this.canvas.height = this.sensorHeight;\n        this.canvasContext = this.canvas.getContext('2d');\n        this.imageBuffer = ZXing._resize(this.sensorWidth, this.sensorHeight);\n        return null;\n      }\n\n      this.canvasContext.drawImage(this.video, this.sensorLeft, this.sensorTop, this.sensorWidth, this.sensorHeight);\n      var data = this.canvasContext.getImageData(0, 0, this.sensorWidth, this.sensorHeight).data;\n\n      for (var i = 0, j = 0; i < data.length; i += 4, j++) {\n        var _ref = [data[i], data[i + 1], data[i + 2]],\n            r = _ref[0],\n            g = _ref[1],\n            b = _ref[2];\n        ZXing.HEAPU8[this.imageBuffer + j] = Math.trunc((r + g + b) / 3);\n      }\n\n      var err = ZXing._decode_qr(this.decodeCallback);\n\n      if (err) {\n        return null;\n      }\n\n      var result = window.zxDecodeResult;\n\n      if (result != null) {\n        return {\n          result: result,\n          canvas: this.canvas\n        };\n      }\n\n      return null;\n    }\n  }]);\n\n  return Analyzer;\n}();\n\nvar Scanner =\n/*#__PURE__*/\nfunction (_EventEmitter) {\n  _inherits(Scanner, _EventEmitter);\n\n  function Scanner(opts) {\n    var _this4;\n\n    _classCallCheck(this, Scanner);\n\n    _this4 = _possibleConstructorReturn(this, _getPrototypeOf(Scanner).call(this));\n    _this4.video = _this4._configureVideo(opts);\n    _this4.mirror = opts.mirror !== false;\n    _this4.backgroundScan = opts.backgroundScan !== false;\n    _this4._continuous = opts.continuous !== false;\n    _this4._analyzer = new Analyzer(_this4.video);\n    _this4._camera = null;\n    var captureImage = opts.captureImage || false;\n    var scanPeriod = opts.scanPeriod || 1;\n    var refractoryPeriod = opts.refractoryPeriod || 5 * 1000;\n    _this4._scanner = new ScanProvider(_assertThisInitialized(_this4), _this4._analyzer, captureImage, scanPeriod, refractoryPeriod);\n    _this4._fsm = _this4._createStateMachine();\n    Visibility.change(function (e, state) {\n      if (state === 'visible') {\n        setTimeout(function () {\n          if (_this4._fsm.can('activate')) {\n            _this4._fsm.activate();\n          }\n        }, 0);\n      } else {\n        if (!_this4.backgroundScan && _this4._fsm.can('deactivate')) {\n          _this4._fsm.deactivate();\n        }\n      }\n    });\n\n    _this4.addListener('active', function () {\n      _this4.video.classList.remove('inactive');\n\n      _this4.video.classList.add('active');\n    });\n\n    _this4.addListener('inactive', function () {\n      _this4.video.classList.remove('active');\n\n      _this4.video.classList.add('inactive');\n    });\n\n    _this4.emit('inactive');\n\n    return _this4;\n  }\n\n  _createClass(Scanner, [{\n    key: \"scan\",\n    value: function scan() {\n      return this._scanner.scan();\n    }\n  }, {\n    key: \"start\",\n    value: function () {\n      var _start = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee() {\n        var camera,\n            _args = arguments;\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                camera = _args.length > 0 && _args[0] !== undefined ? _args[0] : null;\n\n                if (!this._fsm.can('start')) {\n                  _context.next = 6;\n                  break;\n                }\n\n                _context.next = 4;\n                return this._fsm.start(camera);\n\n              case 4:\n                _context.next = 10;\n                break;\n\n              case 6:\n                _context.next = 8;\n                return this._fsm.stop();\n\n              case 8:\n                _context.next = 10;\n                return this._fsm.start(camera);\n\n              case 10:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function start() {\n        return _start.apply(this, arguments);\n      }\n\n      return start;\n    }()\n  }, {\n    key: \"stop\",\n    value: function () {\n      var _stop = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee2() {\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                if (!this._fsm.can('stop')) {\n                  _context2.next = 3;\n                  break;\n                }\n\n                _context2.next = 3;\n                return this._fsm.stop();\n\n              case 3:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function stop() {\n        return _stop.apply(this, arguments);\n      }\n\n      return stop;\n    }()\n  }, {\n    key: \"_enableScan\",\n    value: function () {\n      var _enableScan2 = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee3(camera) {\n        var stream;\n        return regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                this._camera = camera || this._camera;\n\n                if (this._camera) {\n                  _context3.next = 3;\n                  break;\n                }\n\n                throw new Error('Camera is not defined.');\n\n              case 3:\n                _context3.next = 5;\n                return this._camera.start();\n\n              case 5:\n                stream = _context3.sent;\n                this.video.srcObject = stream;\n\n                if (this._continuous) {\n                  this._scanner.start();\n                }\n\n              case 8:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function _enableScan(_x) {\n        return _enableScan2.apply(this, arguments);\n      }\n\n      return _enableScan;\n    }()\n  }, {\n    key: \"_disableScan\",\n    value: function _disableScan() {\n      this.video.src = '';\n\n      if (this._scanner) {\n        this._scanner.stop();\n      }\n\n      if (this._camera) {\n        this._camera.stop();\n      }\n    }\n  }, {\n    key: \"_configureVideo\",\n    value: function _configureVideo(opts) {\n      if (opts.video) {\n        if (opts.video.tagName !== 'VIDEO') {\n          throw new Error('Video must be a <video> element.');\n        }\n      }\n\n      var video = opts.video || document.createElement('video');\n      video.setAttribute('autoplay', 'autoplay');\n      return video;\n    }\n  }, {\n    key: \"_createStateMachine\",\n    value: function _createStateMachine() {\n      var _this5 = this;\n\n      return StateMachine.create({\n        initial: 'stopped',\n        events: [{\n          name: 'start',\n          from: 'stopped',\n          to: 'started'\n        }, {\n          name: 'stop',\n          from: ['started', 'active', 'inactive'],\n          to: 'stopped'\n        }, {\n          name: 'activate',\n          from: ['started', 'inactive'],\n          to: ['active', 'inactive'],\n          condition: function condition(options) {\n            if (Visibility.state() === 'visible' || this.backgroundScan) {\n              return 'active';\n            } else {\n              return 'inactive';\n            }\n          }\n        }, {\n          name: 'deactivate',\n          from: ['started', 'active'],\n          to: 'inactive'\n        }],\n        callbacks: {\n          onenteractive: function () {\n            var _onenteractive = _asyncToGenerator(\n            /*#__PURE__*/\n            regeneratorRuntime.mark(function _callee4(options) {\n              return regeneratorRuntime.wrap(function _callee4$(_context4) {\n                while (1) {\n                  switch (_context4.prev = _context4.next) {\n                    case 0:\n                      _context4.next = 2;\n                      return _this5._enableScan(options.args[0]);\n\n                    case 2:\n                      _this5.emit('active');\n\n                    case 3:\n                    case \"end\":\n                      return _context4.stop();\n                  }\n                }\n              }, _callee4);\n            }));\n\n            function onenteractive(_x2) {\n              return _onenteractive.apply(this, arguments);\n            }\n\n            return onenteractive;\n          }(),\n          onleaveactive: function onleaveactive() {\n            _this5._disableScan();\n\n            _this5.emit('inactive');\n          },\n          onenteredstarted: function () {\n            var _onenteredstarted = _asyncToGenerator(\n            /*#__PURE__*/\n            regeneratorRuntime.mark(function _callee5(options) {\n              return regeneratorRuntime.wrap(function _callee5$(_context5) {\n                while (1) {\n                  switch (_context5.prev = _context5.next) {\n                    case 0:\n                      _context5.next = 2;\n                      return _this5._fsm.activate(options.args[0]);\n\n                    case 2:\n                    case \"end\":\n                      return _context5.stop();\n                  }\n                }\n              }, _callee5);\n            }));\n\n            function onenteredstarted(_x3) {\n              return _onenteredstarted.apply(this, arguments);\n            }\n\n            return onenteredstarted;\n          }()\n        }\n      });\n    }\n  }, {\n    key: \"captureImage\",\n    set: function set(capture) {\n      this._scanner.captureImage = capture;\n    },\n    get: function get() {\n      return this._scanner.captureImage;\n    }\n  }, {\n    key: \"scanPeriod\",\n    set: function set(period) {\n      this._scanner.scanPeriod = period;\n    },\n    get: function get() {\n      return this._scanner.scanPeriod;\n    }\n  }, {\n    key: \"refractoryPeriod\",\n    set: function set(period) {\n      this._scanner.refractoryPeriod = period;\n    },\n    get: function get() {\n      return this._scanner.refractoryPeriod;\n    }\n  }, {\n    key: \"continuous\",\n    set: function set(continuous) {\n      this._continuous = continuous;\n\n      if (continuous && this._fsm.current === 'active') {\n        this._scanner.start();\n      } else {\n        this._scanner.stop();\n      }\n    },\n    get: function get() {\n      return this._continuous;\n    }\n  }, {\n    key: \"mirror\",\n    set: function set(mirror) {\n      this._mirror = mirror;\n\n      if (mirror) {\n        this.video.style.MozTransform = 'scaleX(-1)';\n        this.video.style.webkitTransform = 'scaleX(-1)';\n        this.video.style.OTransform = 'scaleX(-1)';\n        this.video.style.msFilter = 'FlipH';\n        this.video.style.filter = 'FlipH';\n        this.video.style.transform = 'scaleX(-1)';\n      } else {\n        this.video.style.MozTransform = null;\n        this.video.style.webkitTransform = null;\n        this.video.style.OTransform = null;\n        this.video.style.msFilter = null;\n        this.video.style.filter = null;\n        this.video.style.transform = null;\n      }\n    },\n    get: function get() {\n      return this._mirror;\n    }\n  }]);\n\n  return Scanner;\n}(EventEmitter);\n\nmodule.exports = Scanner;",{"version":3,"sources":["/srv/http/bekantan-vue-testing/instascan/src/scanner.js"],"names":["EventEmitter","require","ZXing","Visibility","StateMachine","ScanProvider","emitter","analyzer","captureImage","scanPeriod","refractoryPeriod","_emitter","_frameCount","_analyzer","_lastResult","_active","requestAnimationFrame","_scan","_analyze","skipDups","analysis","analyze","result","canvas","clearTimeout","refractoryTimeout","setTimeout","image","toDataURL","payload","content","emit","Analyzer","video","imageBuffer","sensorLeft","sensorTop","sensorWidth","sensorHeight","document","createElement","style","display","canvasContext","decodeCallback","Runtime","addFunction","ptr","len","resultIndex","resultCount","Uint8Array","HEAPU8","buffer","str","String","fromCharCode","apply","window","zxDecodeResult","videoWidth","videoHeight","Math","floor","width","height","getContext","_resize","drawImage","data","getImageData","i","j","length","r","g","b","trunc","err","_decode_qr","Scanner","opts","_configureVideo","mirror","backgroundScan","_continuous","continuous","_camera","_scanner","_fsm","_createStateMachine","change","e","state","can","activate","deactivate","addListener","classList","remove","add","scan","camera","start","stop","Error","stream","srcObject","src","tagName","setAttribute","create","initial","events","name","from","to","condition","options","callbacks","onenteractive","_enableScan","args","onleaveactive","_disableScan","onenteredstarted","capture","period","current","_mirror","MozTransform","webkitTransform","OTransform","msFilter","filter","transform","module","exports"],"mappings":"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","sourcesContent":["const EventEmitter = require('events');\nconst ZXing = require('./zxing')();\nconst Visibility = require('visibilityjs');\nconst StateMachine = require('fsm-as-promised');\n\nclass ScanProvider {\n  constructor(emitter, analyzer, captureImage, scanPeriod, refractoryPeriod) {\n    this.scanPeriod = scanPeriod;\n    this.captureImage = captureImage;\n    this.refractoryPeriod = refractoryPeriod;\n    this._emitter = emitter;\n    this._frameCount = 0;\n    this._analyzer = analyzer;\n    this._lastResult = null;\n    this._active = false;\n  }\n\n  start() {\n    this._active = true;\n    requestAnimationFrame(() => this._scan());\n  }\n\n  stop() {\n    this._active = false;\n  }\n\n  scan() {\n    return this._analyze(false);\n  }\n\n  _analyze(skipDups) {\n    let analysis = this._analyzer.analyze();\n    if (!analysis) {\n      return null;\n    }\n\n    let { result, canvas } = analysis;\n    if (!result) {\n      return null;\n    }\n\n    if (skipDups && result === this._lastResult) {\n      return null;\n    }\n\n    clearTimeout(this.refractoryTimeout);\n    this.refractoryTimeout = setTimeout(() => {\n      this._lastResult = null;\n    }, this.refractoryPeriod);\n\n    let image = this.captureImage ? canvas.toDataURL('image/webp', 0.8) : null;\n\n    this._lastResult = result;\n\n    let payload = { content: result };\n    if (image) {\n      payload.image = image;\n    }\n\n    return payload;\n  }\n\n  _scan() {\n    if (!this._active) {\n      return;\n    }\n\n    requestAnimationFrame(() => this._scan());\n\n    if (++this._frameCount !== this.scanPeriod) {\n      return;\n    } else {\n      this._frameCount = 0;\n    }\n\n    let result = this._analyze(true);\n    if (result) {\n      setTimeout(() => {\n        this._emitter.emit('scan', result.content, result.image || null);\n      }, 0);\n    }\n  }\n}\n\nclass Analyzer {\n  constructor(video) {\n    this.video = video;\n\n    this.imageBuffer = null;\n    this.sensorLeft = null;\n    this.sensorTop = null;\n    this.sensorWidth = null;\n    this.sensorHeight = null;\n\n    this.canvas = document.createElement('canvas');\n    this.canvas.style.display = 'none';\n    this.canvasContext = null;\n\n    this.decodeCallback = ZXing.Runtime.addFunction(function (ptr, len, resultIndex, resultCount) {\n      let result = new Uint8Array(ZXing.HEAPU8.buffer, ptr, len);\n      let str = String.fromCharCode.apply(null, result);\n      if (resultIndex === 0) {\n        window.zxDecodeResult = '';\n      }\n      window.zxDecodeResult += str;\n    });\n  }\n\n  analyze() {\n    if (!this.video.videoWidth) {\n      return null;\n    }\n\n    if (!this.imageBuffer) {\n      let videoWidth = this.video.videoWidth;\n      let videoHeight = this.video.videoHeight;\n\n      this.sensorWidth = videoWidth;\n      this.sensorHeight = videoHeight;\n      this.sensorLeft = Math.floor((videoWidth / 2) - (this.sensorWidth / 2));\n      this.sensorTop = Math.floor((videoHeight / 2) - (this.sensorHeight / 2));\n\n      this.canvas.width = this.sensorWidth;\n      this.canvas.height = this.sensorHeight;\n\n      this.canvasContext = this.canvas.getContext('2d');\n      this.imageBuffer = ZXing._resize(this.sensorWidth, this.sensorHeight);\n      return null;\n    }\n\n    this.canvasContext.drawImage(\n      this.video,\n      this.sensorLeft,\n      this.sensorTop,\n      this.sensorWidth,\n      this.sensorHeight\n    );\n\n    let data = this.canvasContext.getImageData(0, 0, this.sensorWidth, this.sensorHeight).data;\n    for (let i = 0, j = 0; i < data.length; i += 4, j++) {\n      let [r, g, b] = [data[i], data[i + 1], data[i + 2]];\n      ZXing.HEAPU8[this.imageBuffer + j] = Math.trunc((r + g + b) / 3);\n    }\n\n    let err = ZXing._decode_qr(this.decodeCallback);\n    if (err) {\n      return null;\n    }\n\n    let result = window.zxDecodeResult;\n    if (result != null) {\n      return { result: result, canvas: this.canvas };\n    }\n\n    return null;\n  }\n}\n\nclass Scanner extends EventEmitter {\n  constructor(opts) {\n    super();\n\n    this.video = this._configureVideo(opts);\n    this.mirror = (opts.mirror !== false);\n    this.backgroundScan = (opts.backgroundScan !== false);\n    this._continuous = (opts.continuous !== false);\n    this._analyzer = new Analyzer(this.video);\n    this._camera = null;\n\n    let captureImage = opts.captureImage || false;\n    let scanPeriod = opts.scanPeriod || 1;\n    let refractoryPeriod = opts.refractoryPeriod || (5 * 1000);\n\n    this._scanner = new ScanProvider(this, this._analyzer, captureImage, scanPeriod, refractoryPeriod);\n    this._fsm = this._createStateMachine();\n\n    Visibility.change((e, state) => {\n      if (state === 'visible') {\n        setTimeout(() => {\n          if (this._fsm.can('activate')) {\n            this._fsm.activate();\n          }\n        }, 0);\n      } else {\n        if (!this.backgroundScan && this._fsm.can('deactivate')) {\n          this._fsm.deactivate();\n        }\n      }\n    });\n\n    this.addListener('active', () => {\n      this.video.classList.remove('inactive');\n      this.video.classList.add('active');\n    });\n\n    this.addListener('inactive', () => {\n      this.video.classList.remove('active');\n      this.video.classList.add('inactive');\n    });\n\n    this.emit('inactive');\n  }\n\n  scan() {\n    return this._scanner.scan();\n  }\n\n  async start(camera = null) {\n    if (this._fsm.can('start')) {\n      await this._fsm.start(camera);\n    } else {\n      await this._fsm.stop();\n      await this._fsm.start(camera);\n    }\n  }\n\n  async stop() {\n    if (this._fsm.can('stop')) {\n      await this._fsm.stop();\n    }\n  }\n\n  set captureImage(capture) {\n    this._scanner.captureImage = capture;\n  }\n\n  get captureImage() {\n    return this._scanner.captureImage;\n  }\n\n  set scanPeriod(period) {\n    this._scanner.scanPeriod = period;\n  }\n\n  get scanPeriod() {\n    return this._scanner.scanPeriod;\n  }\n\n  set refractoryPeriod(period) {\n    this._scanner.refractoryPeriod = period;\n  }\n\n  get refractoryPeriod() {\n    return this._scanner.refractoryPeriod;\n  }\n\n  set continuous(continuous) {\n    this._continuous = continuous;\n\n    if (continuous && this._fsm.current === 'active') {\n      this._scanner.start();\n    } else {\n      this._scanner.stop();\n    }\n  }\n\n  get continuous() {\n    return this._continuous;\n  }\n\n  set mirror(mirror) {\n    this._mirror = mirror;\n\n    if (mirror) {\n      this.video.style.MozTransform = 'scaleX(-1)';\n      this.video.style.webkitTransform = 'scaleX(-1)';\n      this.video.style.OTransform = 'scaleX(-1)';\n      this.video.style.msFilter = 'FlipH';\n      this.video.style.filter = 'FlipH';\n      this.video.style.transform = 'scaleX(-1)';\n    } else {\n      this.video.style.MozTransform = null;\n      this.video.style.webkitTransform = null;\n      this.video.style.OTransform = null;\n      this.video.style.msFilter = null;\n      this.video.style.filter = null;\n      this.video.style.transform = null;\n    }\n  }\n\n  get mirror() {\n    return this._mirror;\n  }\n\n  async _enableScan(camera) {\n    this._camera = camera || this._camera;\n    if (!this._camera) {\n      throw new Error('Camera is not defined.');\n    }\n\n    let stream = await this._camera.start();\n    this.video.srcObject = stream;\n\n    if (this._continuous) {\n      this._scanner.start();\n    }\n  }\n\n  _disableScan() {\n    this.video.src = '';\n\n    if (this._scanner) {\n      this._scanner.stop();\n    }\n\n    if (this._camera) {\n      this._camera.stop();\n    }\n  }\n\n  _configureVideo(opts) {\n    if (opts.video) {\n      if (opts.video.tagName !== 'VIDEO') {\n        throw new Error('Video must be a <video> element.');\n      }\n    }\n\n    let video = opts.video || document.createElement('video');\n    video.setAttribute('autoplay', 'autoplay');\n\n    return video;\n  }\n\n  _createStateMachine() {\n    return StateMachine.create({\n      initial: 'stopped',\n      events: [\n        {\n          name: 'start',\n          from: 'stopped',\n          to: 'started'\n        },\n        {\n          name: 'stop',\n          from: ['started', 'active', 'inactive'],\n          to: 'stopped'\n        },\n        {\n          name: 'activate',\n          from: ['started', 'inactive'],\n          to: ['active', 'inactive'],\n          condition: function (options) {\n            if (Visibility.state() === 'visible' || this.backgroundScan) {\n              return 'active';\n            } else {\n              return 'inactive';\n            }\n          }\n        },\n        {\n          name: 'deactivate',\n          from: ['started', 'active'],\n          to: 'inactive'\n        }\n      ],\n      callbacks: {\n        onenteractive: async (options) => {\n          await this._enableScan(options.args[0]);\n          this.emit('active');\n        },\n        onleaveactive: () => {\n          this._disableScan();\n          this.emit('inactive');\n        },\n        onenteredstarted: async (options) => {\n          await this._fsm.activate(options.args[0]);\n        }\n      }\n    });\n  }\n}\n\nmodule.exports = Scanner;\n"]}]}